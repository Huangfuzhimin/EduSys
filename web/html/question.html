<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<title>java练习</title>
		<script src="/static/js/jquery-2.2.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/jquery.params.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type=text/css href="/static/css/itheima.css">
		<style type="text/css">
			#area_question,
			#area_code,
			#area_result {
				background-color: #EEEEEE;
				height: 500px;
				overflow:auto;
				padding: 5px;
			}
			
			#area_question,
			#area_code {
				float: left;
				margin-bottom: 10px;
			}
			
			#area_result {
				margin-top: 10px;
				height: 250px;
				clear: both;
			}
		</style>
	</head>

	<body>

		<div>

			<div id="header" style="background-color: #EEEEEE;">
				<h2 style="text-align: center; padding: 10px;">
					黑马程序员教考系统
				</h2>
			</div>
			<div>
				<a href="/html/java.html/">
				<span style='font-size:200%;'>
				Itheima
				</span>
				</a>

				> <a href="/html/java.html/">章节列表</a>
				> <span ><a id="current_chapter" href="#" onclick="javascript:history.back(-1)">Array-2</a></span>
				> <span id="current_question">666</span>
			</div>

			<div id="area_question" style="width: 33%;">
				<p hidden="hidden">
					username:<br/> <input type="text" id="username" value="aaa" name="username" />
				</p>

				<p>
					<select hidden="hidden" name="questionid" id="questionid" onchange="show_sub(this.options[this.options.selectedIndex].value)">
						<option value="" disabled="true" selected="true">选择题目</option>
						<option value="frontPiece" >frontPiece</option>
						<option value="makeLast">makeLast</option>
						<option value="has23">has23</option>
						<!--<option value="exam04">题目4</option>-->
					</select>
				</p>

				<p id="questiondesc">

				</p>

			</div>
			<div id="area_code" style="width: 63%;margin-left: 1%;">

					Itheima.java :<br/>
					<textarea rows="25" style="padding: 5px;width: 98%; height: 80%;" id="codeArea" name="code">
public class Itheima{

}
       			</textarea>
       			
   				<input type="submit" id="btn-submit" value="提交测试" style="width: 300px; height: 50px; position: relative; float: left;margin: 5px;"/>
   				<p style="float: left;">Save, Compile, Run</p>
			</div>
			<div id="area_result">
				
					<div id="submit-result"></div>
			</div>
		</div>

		<script>
			function show_sub(v) {
				$.get("/desc", {
					"chapter": chapter,
					"questionid": v
				}, function(result) {
					$("#questiondesc").html(result);
				});
			}

			function submitSuccess(result) {
				var result = jQuery.parseJSON(result);
				if(result.code == 0) {
					console.log("success");
					var data = result.data;
					var arg = {};
					arg.username = data.username;
					arg.chapter = data.chapter;
					arg.questionid = data.questionid;
					arg.time = data.currentTime;

					$("#submit-result").load(
						"/report",
						arg,
						function(data) {
							console.log(data);
						}
					);
				} else {
					console.log(result.code);
					console.log(result.data);
					$("#submit-result").html(result.data);
				}

			}

			function bindEvent() {

				// 表单提交
				$("#btn-submit").on("click", function() {
					//				alert("表单提交了")

					// 从本地localStorage读取
					// 如果没有, 创建并存储
					var username = "aaa";
					var code = $("#codeArea").val();
					var questionid = name;

					var arg = {
						"chapter": chapter,
						"username": username,
						"code": code,
						"questionid": questionid
					};
//					console.log(JSON.stringify(arg))
					
					if(!username || !code || !questionid) {
						alert("请确认代码和题目已获取")
						return;
					}

					//				
					$.post(
						"/run",
						arg,
						submitSuccess
					)
				});
			}
			
			function initQuestion () {
				
				$.get("/desc",
					{
						"chapter": chapter,
						"questionid": name
					}, 
					function(result) {
						$("#questiondesc").html(result);
					}
				);
			}

			var chapter = "";
			var name = "";
			$(document).ready(function() {

				bindEvent();
				
				chapter = $.query.get("chapter");
				name = $.query.get("name");
				var title = $.query.get("title");

				if(!chapter) chapter = "Array-1";
				if(!name) name = "firstLast6";

				$("#current_chapter").text(chapter);
				$("#current_question").text(title + "("+name+")");
//				console.log(chapter+"_"+name);
				initQuestion();
			})
		</script>

	</body>

</html>