<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>java练习</title>
	<script src="js/jquery-2.2.3.min.js" type="text/javascript" charset="utf-8"></script>
	<style type="text/css">
		#area_question,
		#area_code,
		#area_result {
			background-color: #EEEEEE;
			height: 500px;
			overflow:auto;
		}

		#area_question,
		#area_code {
			float: left;
			margin-bottom: 10px;
		}

		#area_result {
			margin-top: 10px;
			height: 250px;
			clear: both;
		}
	</style>
</head>

<body>

<div>
	<div id="header" style="background-color: #EEEEEE;">
		<h2 style="text-align: center; padding: 10px;">Java教考系统</h2>
	</div>

	<div id="area_question" style="width: 33%;">
		<p>
			username:<br/> <input type="text" id="username" value="aaa" name="username" />
		</p>

		<p>
			Itheima code:<br/>

		</p>
		<p>
			<select name="questionid" id="questionid" onchange="show_sub(this.options[this.options.selectedIndex].value)">
				<option value="" disabled="true" selected="true">选择题目</option>
				<option value="makeChocolate" >makeChocolate</option>
				<option value="minCat">minCat</option>
				<option value="has22">has22</option>
				<!--<option value="exam04">题目4</option>-->
			</select>
		</p>

		<p id="questiondesc">

		</p>

	</div>
	<div id="area_code" style="width: 65%;margin-left: 2%;">

					<textarea rows="25" style="width: 100%;" id="codeArea" name="code">
public class Itheima{

}
       			</textarea>

		<input type="submit" id="btn-submit" value="提交测试"/>
	</div>
	<div id="area_result">

		<div id="submit-result"></div>
	</div>
</div>

<script>
	function show_sub(v) {
		$.get("/edu/desc", {
			"questionid": v
		}, function(result) {
			$("#questiondesc").html(result);
		});
	}

	function submitSuccess(result) {
		var result = jQuery.parseJSON(result);
		if(result.code == 0) {
			console.log("success");
			var data = result.data;
			var arg = {};
			arg.username = data.username;
			arg.questionid = data.questionid;
			arg.time = data.currentTime;

			$("#submit-result").load(
					"/edu/report",
					arg,
					function(data) {
						console.log(data);
					}
			);
		} else {
			console.log(result.code);
			console.log(result.data);
			$("#submit-result").html(result.data);
		}

	}

	function bindEvent() {

		// 表单提交
		$("#btn-submit").on("click", function() {
			//				alert("表单提交了")

			var username = $("#username").val();
			var code = $("#codeArea").val();
			var questionid = $("#questionid").val();

			var arg = {
				"username": username,
				"code": code,
				"questionid": questionid
			};
//					console.log(JSON.stringify(arg))

			if(!username || !code || !questionid) {
				alert("请确认用户名, 题目已配置")
				return;
			}

			//
			$.post(
					"/edu/run",
					arg,
					submitSuccess
			)
		});
	}

	$(document).ready(function() {

		bindEvent();
	})
</script>

</body>

</html>